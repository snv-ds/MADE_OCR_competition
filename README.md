# MADE_OCR_competition

Ноутбук с Kaggle InClass соревнования "Car plates OCR", проходившего рамках курса MADE Computer Vision.

## Описание задачи

В рамках соревнования надо было детектировать текст номера с фотографии автомобиля. В качестве соревновательной метрики было выбрано расстояние Левенштейна.  

![Alt text](images/Unknown-2.png?raw=true "Sample")

## Ключевые моменты решения и испробованные подходы

### Модели

Для решения задачи было разработано две нейронных сети: 
1) для детекции номера на фотографии
2) для считывания текста с вырезанного участка с номером из исходной фотографии.
Для детекции было испробованно сначала сеть fasterrcnn(для определения bounding box), у которой в качестве backbon'а была выбрана resnet50 и модель mask-rcnn(для сегментации номерного знака у автомобиля). Обе сети показали сопоставимое качество и определяли 94% номерных знаков корректно, но выбор в конечной модели был сделан в пользу mask-rcnn, потому что после выделения номера и применения perspective transform качество детекции текста следующей модели увелличивалось на 10-15%.
Для детекции текста с номерного знака была сделана CRNN сеть, у которой в качестве backbon'а были испробованы сети resnet18, resnet34 и resnet50. Более тяжеловесные сети на таком небольшом количестве тренировочных изображений быстро начинали переобучаться, поэтому для финального решения оказалось достаточно использовать resnet18, хотя resnet34 показала сопоставимые результаты.

### Детали обучения
Каждая модель училась по 2-4 эпохи, используя Adam в качестве оптимизатора и ReduceLROnPlateau в качестве scheduler'a. Так как loss переставал падать достаточно быстро, необходимость обучать на большом количестве эпох не было смысла. Из большого количества потребляемой памяти размер батча у сети сегментации пришлось выбрать маленьким(равным 6). Для сети детекции номера размер батча уже можно было немного увеличить, но это не давало ощутимых преимуществ, поэтому я оставил его равным 8.
Также был опробован подход примешивания сгенерированных синтетических номеров, это помогло увеличить качество работы модели.

### Аугментации

Как это часто бывает, ключевым моментом в решении задачи по CV является хорошие аугментации. Для обеих сетей аугментации использовались примерно одни и теже. Самые ключевые, которые помогли - resize, Pad, RandomErasing, Grayscale, randomrotate(на угол небольший 17 градусов, больше ухудшало качество), blur и игра с контрастностью изображения. Для синтетических изображений применялись отдельные аугментации, так как если их не "подпортить", то модель начинала переобучаться под них и хуже работать на реальных изображениях. Использовались библиотеки torchvision.transforms и albumentations. 

## Результат

![Alt text](images/submits.png?raw=true "Submit")
